{"version":3,"sources":["../../src/BaseType.js"],"names":[],"mappings":"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","file":"src/BaseType.js","sourcesContent":["import _ from \"lodash\"\n\nexport default class BaseType {\n\n    static create(value, isReadOnly, options){\n        return new this(value, isReadOnly, options);\n    }\n\n    static wrapValue(value, spec, isReadOnly, options){\n        Object.keys(spec).forEach((key) => {\n            var fieldValue = (value[key] !== undefined) ? value[key] : spec[key].defaults();\n            value[key] = spec[key].type.create(fieldValue,  isReadOnly, spec[key].options);\n        });\n        return value;\n    }\n\n    constructor(value, isReadOnly = false, options = {}){\n        this.__isReadOnly__ = !!isReadOnly;\n        this.__readOnlyInstance__ = this.__isReadOnly__ ? this : null;\n        this.__isInvalidated__ = -1;\n        this.__options__ = options;\n        if(this.__isReadOnly__) {\n            this.__value__ = value;\n        } else {\n            this.__value__ = this.constructor.wrapValue(\n                (value === undefined) ? this.constructor.defaults() : value,\n                this.constructor._spec,\n                this.__isReadOnly__,\n                options\n            );\n        }\n    }\n\n    setValue(newValue){\n        this.__isInvalidated__ = true;\n        if(newValue instanceof BaseType){\n            newValue = newValue.toJSON();\n        }\n        _.forEach(newValue, (fieldValue, fieldName) => {\n            this[fieldName] = fieldValue;\n        });\n    }\n\n    $asReadOnly(){\n        if(!this.__readOnlyInstance__) {\n            this.__readOnlyInstance__ = this.constructor.type.create(this.__value__, true, this.__options__);\n        }\n        return this.__readOnlyInstance__;\n    }\n\n    $isInvalidated(){\n        if(this.__isInvalidated__ === -1) {\n            var invalidatedField = _.find(this.constructor._spec, (fieldDef, fieldName)=>{\n                if(fieldDef.type.prototype instanceof BaseType) {\n                    return this.__value__[fieldName].$isInvalidated();\n                }\n            });\n            if(invalidatedField) {\n                this.__isInvalidated__ = true;\n            }else{\n                this.__isInvalidated__ = false;\n            }\n        }\n        return this.__isInvalidated__;\n    }\n\n    $revalidate(){\n        this.__isInvalidated__ = -1;\n        _.forEach(this.constructor._spec, (fieldDef, fieldName)=>{\n            if(fieldDef.type.prototype instanceof BaseType){\n                this.__value__[fieldName].$revalidate();\n            }\n        });\n    }\n\n    $resetValidationCheck(){\n        this.__isInvalidated__ = this.__isInvalidated__ || -1;\n        _.forEach(this.constructor._spec, (fieldDef, fieldName) => {\n            if(fieldDef.type.prototype instanceof BaseType) {\n                this.__value__[fieldName].$resetValidationCheck();\n            }\n        });\n    }\n\n    toJSON(){\n        return Object.keys(this.constructor._spec).reduce((json, key) => {\n            var fieldValue = this.__value__[key];\n            json[key] = fieldValue.toJSON ? fieldValue.toJSON() : fieldValue;\n            return json;\n        }, {});\n    }\n\n}\n"]}