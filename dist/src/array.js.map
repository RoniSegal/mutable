{"version":3,"sources":["..\\..\\src\\array.js"],"names":[],"mappings":"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","file":"src/array.js","sourcesContent":["import _ from \"lodash\"\nimport defineType from \"./defineType\"\nimport BaseType from \"./BaseType\"\nimport number from \"./number\"\nimport string from \"./string\"\nimport {generateWithDefault} from \"./defineTypeUtils\"\n\nexport default class _Array extends BaseType {\n\n    static defaults() { return []; }\n\n    static test(value) { return Array.isArray(value); }\n\n    static wrapValue(value, spec, options) {\n\n        if(value instanceof BaseType) {\n            return value.__value__.map((itemValue) => {\n                return this._wrapSingleItem(itemValue, options);\n            }, this);\n        }\n\n        return value.map((itemValue) => {\n            return this._wrapSingleItem(itemValue, options);\n        }, this);\n    }\n\n    static _wrapSingleItem(itemValue, options) {\n        if(itemValue instanceof BaseType) {\n            return itemValue;\n        } else if(typeof options.subTypes === 'function') {\n            return options.subTypes.create(itemValue, options.subTypes.options);\n        } else if(typeof options.subTypes === 'object') {\n\n            var subType = options.subTypes[\n                itemValue._type ? itemValue._type  :\n                number.test(itemValue) ? '_Number' :\n                string.test(itemValue) ? '_String' :\n                Object.keys(options.subTypes)[0]\n            ];\n\n            return subType.create(itemValue, subType.options);\n        }\n    }\n\n    static of(subTypes, defaults, test) {\n        return this.withDefault(defaults, test, { subTypes });\n    };\n\n    constructor(value=[], options={}) {\n        if(options.subTypes && _.isArray(options.subTypes)) {\n            options.subTypes = options.subTypes.reduce(function(subTypes, type) {\n                subTypes[type.displayName || type.name] = type;\n                return subTypes;\n            }, {});\n        }\n\n        super(value, options);\n    }\n\n    toJSON() {\n        return this.__value__.map(item => {\n            return (item instanceof BaseType) ? item.toJSON() : item;\n        });\n    }\n\n    at(index) {\n        var item = this.__value__[index];\n        return (this.__isReadOnly__ && item instanceof BaseType) ? item.$asReadOnly() : item;\n    }\n\n    push(...newItems) {\n        if(this.__isReadOnly__) {\n            return null;\n        }\n\n        this.__isInvalidated__= true;\n\n        var options = this.__options__;\n\n        return Array.prototype.push.apply(\n            this.__value__,\n            newItems.map((item) => this.constructor._wrapSingleItem(item, options))\n        );\n    }\n\n    forEach(cb) {\n        var that = this;\n        this.__value__.forEach(function(item, index, arr) {\n            cb(item, index, that);\n        });\n    }\n\n    map(cb, ctx) { // ToDo: remove\n        this.__value__.map(function(item, index, arr) {\n            return cb(item, index, this);\n        }, ctx || this);\n\n    }\n\n    splice(index, removeCount, ...addedItems) {\n        if(this.__isReadOnly__) {\n            return null;\n        }\n        this.__isInvalidated__= true;\n        var spliceParams = [index,removeCount];\n        addedItems.forEach(function(newItem) {\n           spliceParams.push(this.constructor._wrapSingleItem(newItem, this.__options__))\n        }.bind(this));\n        return this.__value__.splice.apply(this.__value__, spliceParams);\n        //return this.__value__.push(this.constructor._wrapSingleItem(newItem, this.__isReadOnly__, this.__options__));\n    }\n\n\n    concat(...addedArrays) {\n        return new this.constructor(Array.prototype.concat.apply(this.__value__, addedArrays.map((array) => array.__value__ || array)), this.__options__);\n    }\n\n    every(cb) {\n        var self = this;\n        return this.__value__.every(function(element, index, array) {\n            return cb(element, index, self)\n        });\n    }\n\n    some(cb) {\n        var self = this;\n        return this.__value__.some(function(element, index, array) {\n            return cb(element, index, self);\n        });\n    }\n\n    find(cb) {\n        var self = this;\n        return _.find(this.__value__, function(element, index, array) {\n            return cb(element, index, self);\n        });\n        return _.find(this.__value__, cb);\n    }\n\n    findIndex(cb) {\n        var self = this;\n        return _.findIndex(this.__value__, function (element, index, array) {\n            return cb(element, index, self)\n        })\n        return _.findIndex(this.__value__, cb);\n    }\n\n    filter(cb) {\n        var self = this;\n        var filteredArray = this.__value__.filter(function(element, index, array) {\n            return cb(element, index, self);\n        });\n        return new this.constructor(filteredArray, this.__options__, false);\n    }\n\n    setValue(newValue) {\n        if(newValue instanceof _Array) {\n            newValue = newValue.toJSON();\n        }\n        if(_.isArray(newValue)) {\n\t\t\t//fix bug #33. reset the current array instead of replacing it;\n            this.__value__.length = 0;\n            _.forEach(newValue, (itemValue) => {\n                this.push(itemValue);\n            });\n        }\n    }\n\n    $isInvalidated() {\n\n        if(this.__isInvalidated__==-1) {\n            var invalidatedField = _.find(this.__value__, (item, index)=>{\n                if(item instanceof BaseType) {\n                    return item.$isInvalidated();\n                }\n            });\n            if(invalidatedField) {\n                this.__isInvalidated__ = true;\n            }else{\n                this.__isInvalidated__ = false;\n            }\n        }\n        return this.__isInvalidated__;\n    }\n\n    $revalidate() {\n        this.__isInvalidated__ = -1;\n        _.forEach(this.__value__, (item, index)=>{\n            if(item instanceof BaseType) {\n                item.$revalidate();\n            }\n        });\n    }\n\n    $resetValidationCheck() {\n        this.__isInvalidated__ = this.__isInvalidated__ || -1;\n        _.forEach(this.__value__, (item, index)=>{\n            if(item instanceof BaseType) {\n                item.$resetValidationCheck();\n            }\n        });\n    }\n\n}\n\n_Array.withDefault = generateWithDefault();\n\n\n\n//['map', 'filter', 'every', 'forEach'].map(function(key) {\n['map'].map(function(key) {\n\n    var loFn = _[key];\n\n    _Array.prototype[key] = function(fn, ctx) {\n\n        return loFn(this.__value__, function() {\n            return fn.apply(ctx || this, arguments);\n        });\n\n    }\n});\n\ndefineType('Array',{\n    spec: function() {\n        return {\n            length: number.withDefault(0)\n        };\n    }\n}, _Array);\n"]}